# -*- mode: apacheconf; -*-
###########
# general #
###########

daemonize no
pidfile /var/run/narc.pid

###########
# logging #
###########

loglevel notice
logfile /var/log/narc.log
syslog-enabled no
syslog-ident narc
syslog-facility local0

##########
# server #
##########

# remote syslog 
remote-host <%= logtap.split(':').first %>
remote-port <%= logtap.split(':').last %>
remote-proto udp

# max server connect attempts
max-connect-attempts 12
# millisecond delay between attempts
connect-retry-delay 5000

###########
# streams #
###########

# max file open attempts
max-open-attempts 12
# millisecond delay between attempts
open-retry-delay 5000

# identifier to prefix all messages with
stream-id <%= app %>

# syslog facility for streams
stream-facility user

# syslog priority for streams
stream-priority error

# log streams
<%
if boxfile[:exec].is_a? Hash
  boxfile[:exec].each do |name, exec|
-%>
stream <%= uid %>.<%= name %>[daemon] /var/log/gonano/<%= name %>/current
<%
  end
else
-%>
stream <%= uid %>.app[daemon] /var/log/gonano/app/current
<%
end
-%>
<% boxfile[:log_watch].each do |key, value| -%>
stream <%= uid %>.<%= key %> <%= value %>
<% end -%>
